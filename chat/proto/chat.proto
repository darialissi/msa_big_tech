syntax = "proto3";

package github.com.darialissi.msa_big_tech.chat;

import "buf/validate/validate.proto";

option go_package = "github.com/darialissi/msa_big_tech/chat/pkg;chat";


// Создание личного чата
message CreateDirectChatRequest {
  string participant_id = 1 [
    (buf.validate.field).string.uuid = true,
    (buf.validate.field).required = true
  ];
}

message CreateDirectChatResponse {
  string chat_id = 1;
}

// Получение информации о чате
message GetChatRequest {
  string chat_id = 1 [
    (buf.validate.field).string.uuid = true,
    (buf.validate.field).required = true
  ];
}

message GetChatResponse {
  Chat chat = 1;
}

// Получение списка чатов пользователя
message ListUserChatsRequest {
  string user_id = 1 [
    (buf.validate.field).string.uuid = true,
    (buf.validate.field).required = true
  ];
}

message ListUserChatsResponse {
  repeated ChatMember chats = 1;
}

// Получение списка участников чата
message ListChatMembersRequest {
  string chat_id = 1 [
    (buf.validate.field).string.uuid = true,
    (buf.validate.field).required = true
  ];
}

message ListChatMembersResponse {
  repeated ChatMember members = 1;
}

// Отправление сообщения
message SendMessageRequest {
  string chat_id = 1 [
    (buf.validate.field).string.uuid = true,
    (buf.validate.field).required = true
  ];
  string text = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 1
  ];
}

message SendMessageResponse {
  Message message = 1;
}

// Получение истории сообщений чата
message ListMessagesRequest {
  string chat_id = 1 [
    (buf.validate.field).string.uuid = true,
    (buf.validate.field).required = true
  ];
  uint64 limit = 2;
  string cursor = 3;
}

message ListMessagesResponse {
  repeated Message messages = 1;
  string next_cursor = 2;
}

// Серверный стрим новых сообщений
message StreamMessagesRequest {
  string chat_id = 1 [
    (buf.validate.field).string.uuid = true,
    (buf.validate.field).required = true
  ];
  int64 since_unix_ms = 2;
}

message StreamMessagesResponse {
  repeated Message stream = 1;
}

// Объекты
message Chat {
  string chat_id = 1;
  string creator_id = 2;
}

message ChatMember {
  string user_id = 1;
  string chat_id = 2;
}

message Message {
  string message_id = 1;
  string text = 2;
  string sender_id = 3;
  string chat_id = 4;
}